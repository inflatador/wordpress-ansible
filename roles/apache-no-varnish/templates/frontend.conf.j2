# Generated by ansible-role-httpd

# VHost for serving site traffic

<VirtualHost *:80>
    ServerName {{ my_pub_ip4 }}
    ServerAlias {{ my_pub_ip6 }}
    ErrorLog {{ apache_log_path }}/wordpress-frontend-error.log
    CustomLog {{ apache_log_path }}/wordpress-frontend-access.log combined

    SetEnvIf X-Forwarded-Proto https HTTPS=on

    <FilesMatch ".+\.ph(ar|p|tml)$">
    SetHandler "proxy:unix:/run/php/php7.2-fpm.sock|fcgi://localhost"
    </FilesMatch>

    DocumentRoot /var/www/vhosts/wordpress

    <Directory /var/www/vhosts/wordpress>
        AllowOverride All
        Options -Indexes +FollowSymLinks
        Require all granted
    </Directory>


</VirtualHost>


<VirtualHost *:443>
    ServerName {{ my_pub_ip4 }}
    ServerAlias {{ my_pub_ip6 }}
    ErrorLog {{ apache_log_path }}/wordpress-frontend-error.log
    CustomLog {{ apache_log_path }}/wordpress-frontend-access.log combined

    SSLEngine On
    SSLCertificateFile {{ ssl_cert_path }}/wordpress.crt
    SSLCertificateKeyFile {{ ssl_key_path }}/wordpress.key

    #comment


    # ProxyPass will default add `X-Forwarded-For`, `X-Forwarded-Host` and `X-Forwarded-Server`

    RequestHeader set X-Forwarded-Proto https
    RequestHeader set X-Forwarded-Port 443

    <FilesMatch ".+\.ph(ar|p|tml)$">
    SetHandler "proxy:unix:/run/php/php7.2-fpm.sock|fcgi://localhost"
    </FilesMatch>

    DocumentRoot /var/www/vhosts/wordpress

    <Directory /var/www/vhosts/wordpress>
        AllowOverride All
        Options -Indexes +FollowSymLinks
        Require all granted
    </Directory>

</VirtualHost>